<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>あきんどカルタゲーム</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f5f5;
      color: #222;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 12px;
    }

    .game-container {
      width: 100%;
      max-width: 480px;
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.08);
      padding: 16px 16px 20px;
    }

    header {
      text-align: center;
      margin-bottom: 12px;
    }

    header h1 {
      font-size: 20px;
      margin-bottom: 4px;
    }

    header p {
      font-size: 12px;
      color: #666;
    }

    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      margin-bottom: 8px;
      color: #555;
    }

    .status-bar span {
      min-width: 80px;
    }

    .leading-kana {
      text-align: center;
      margin: 8px 0;
      font-size: 40px;
      font-weight: bold;
    }

    .full-phrase {
      text-align: center;
      margin: 4px 0 10px;
      min-height: 24px;
      font-size: 14px;
      color: #333;
    }

    .cards-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-bottom: 8px;
    }

    .card {
      position: relative;
      background: #fafafa;
      border-radius: 12px;
      overflow: hidden;
      border: 2px solid transparent;
      cursor: pointer;
      transition: transform 0.12s ease, box-shadow 0.12s ease, border-color 0.12s ease;
      min-height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .card img {
      width: 100%;
      height: auto;
      display: block;
      object-fit: cover;
    }

    .card.disabled {
      cursor: default;
      opacity: 0.7;
    }

    .card:hover:not(.disabled) {
      transform: translateY(-1px);
      box-shadow: 0 3px 8px rgba(0,0,0,0.08);
    }

    .card.correct {
      border-color: #2e7d32;
    }

    .card.wrong {
      border-color: #c62828;
    }

    .kana-cover {
      position: absolute;
      top: 4px;
      right: 4px;
      width: 56px;
      height: 56px;
      background: #ffffff;
      box-shadow: 0 0 4px rgba(255,255,255,0.8);
    }

    .info-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      margin: 6px 0;
      color: #555;
    }

    .timer {
      font-variant-numeric: tabular-nums;
    }

    .score {
      font-variant-numeric: tabular-nums;
      font-weight: 600;
    }

    .message {
      min-height: 20px;
      font-size: 13px;
      margin: 4px 0;
    }

    .message.ok {
      color: #2e7d32;
    }

    .message.ng {
      color: #c62828;
    }

    .explanation {
      margin-top: 6px;
      font-size: 12px;
      line-height: 1.5;
      background: #f8f8f8;
      border-radius: 8px;
      padding: 8px;
      max-height: 140px;
      overflow-y: auto;
    }

    .buttons {
      margin-top: 10px;
      display: flex;
      justify-content: center;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 8px 20px;
      font-size: 14px;
      cursor: pointer;
      background: #1976d2;
      color: #fff;
      font-weight: 600;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      transition: opacity 0.12s ease, transform 0.12s ease, box-shadow 0.12s ease;
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    .btn:not(:disabled):active {
      transform: translateY(1px);
      box-shadow: 0 1px 3px rgba(0,0,0,0.18);
    }

    .final-result {
      margin-top: 8px;
      font-size: 13px;
      text-align: center;
      color: #333;
    }

    @media (max-width: 360px) {
      .game-container {
        padding: 12px;
      }
      .leading-kana {
        font-size: 32px;
      }
    }
  </style>
</head>
<body>
  <div class="game-container">
    <header>
      <h1>あきんどカルタ</h1>
      <p>「あきんどの精神」を学ぶカルタゲーム</p>
    </header>

    <div class="status-bar">
      <span id="questionCount">第1問</span>
      <span id="progress"></span>
    </div>

    <div class="leading-kana" id="leadingKana">あ</div>
    <div class="full-phrase" id="fullPhrase"></div>

    <div class="cards-grid" id="cardsGrid">
      <!-- 絵札カードをここにJSで生成 -->
    </div>

    <div class="info-bar">
      <span class="timer">タイマー：<span id="timerText">--.-</span> 秒</span>
      <span class="score">スコア：<span id="scoreText">0</span> 点</span>
    </div>

    <div class="message" id="message"></div>

    <div class="explanation" id="explanation" style="display:none;"></div>

    <div class="buttons">
      <button class="btn" id="nextButton" style="display:none;">次の問題へ</button>
    </div>

    <div class="final-result" id="finalResult"></div>
  </div>

  <script>
    // ====== 設定値 ======
    const MAX_TIME_MS = 10000;         // 絵札表示からの制限時間（ミリ秒）
    const POINTS_PER_SECOND = 10;      // 1秒あたりの加点
    const WRONG_PENALTY = -20;         // 不正解 & 時間切れペナルティ

    // ====== 使うかなの一覧 ======
    const kanaList = [
      "あ","い","う","え","お",
      "か","き","く","け","こ",
      "さ","し","す","せ","そ",
      "た","ち","つ","て","と",
      "な","に","ぬ","ね","の",
      "は","ひ","ふ","へ","ほ",
      "ま","み","む","め","も",
      "や","ゆ","よ",
      "ら","り","る","れ","ろ",
      "わ","を","ん"
    ];

    // かな → ファイル名のキー（.jpg は後で付ける）
    const kanaToFileKey = {
      "あ": "a",
      "い": "i",
      "う": "u",
      "え": "e",
      "お": "o",

      "か": "ka",
      "き": "ki",
      "く": "ku",
      "け": "ke",
      "こ": "ko",   // 札は「ご」だがファイル名は ko.jpg

      "さ": "sa",
      "し": "si",
      "す": "su",
      "せ": "se",
      "そ": "so",

      "た": "ta",
      "ち": "ti",
      "つ": "tu",
      "て": "te",
      "と": "to",

      "な": "na",
      "に": "ni",
      "ぬ": "nu",
      "ね": "ne",
      "の": "no",

      "は": "ha",
      "ひ": "hi",
      "ふ": "hu",
      "へ": "he",
      "ほ": "ho",

      "ま": "ma",
      "み": "mi",
      "む": "mu",
      "め": "me",
      "も": "mo",

      "や": "ya",
      "ゆ": "yu",
      "よ": "yo",

      "ら": "ra",
      "り": "ri",
      "る": "ru",
      "れ": "re",
      "ろ": "ro",

      "わ": "wa",
      "を": "wo",
      "ん": "n"
    };

    // ====== 問題データ======
   const questions = [
  {
    id: "q1",
    kana: "あ",
    leadingKana: "あ",
    fullPhrase: "あ：あかんモンはあかん",
    explanation: `いろいろと事情はあります。事情がないというコトの方が少
ないでしょう。でも、どんな事情があっても商人の正義に反
することに手をつけては駄目です。ここに議論はありません。
キッパリと言い切りましょう。
ところが、「あかん、あかん言うとったらあかん」でもあり
ます。一度や二度の挑戦で結果が出ないといって諦めてはい
けない、という意味です。注意しましょう。`
  },
  {
    id: "q2",
    kana: "い",
    leadingKana: "い",
    fullPhrase: "い：いつだって  3％と 1/3",
    explanation: `商いの道にはゴールも正解もありませんが、無駄を省く事は、
基本の心得です。
この実践は二つです。乾いた雑巾を絞るのは、普段の 3％ に目を
光らせることです。常に丁寧に意識していないと見えてこない
モノがそんな所に隠れているコトもあるのです。

もう一つが何もせずにじっと見て、じっと眺めて大きく 1/3 を
削減する、です。
前者は普段の心掛け、後者は運と思考の賜物です。何時も複
数のやり方を考えているのが商人です。`
  },
  {
    id: "q3",
    kana: "う",
    leadingKana: "う",
    fullPhrase: "う：ウソつくな ウソつくときは 己も騙せ",
    explanation: `商いにウソはいけません。ですが、時には「奥さま、今日もお
美しい」のお世辞も必要ですし、覚悟を示す時には「あきんど
人生を賭けまっせ」などと言います。事実ではありませんが、
一々ウソだと咎められることはありません。全くのウソではな
い「大げさな表現」と言える所まではセーフなのです。
だったら、本気で言える所まで自分を騙してでも思い込むのが
商人です。商人はウソをついてはいけないのです。`
  },
  {
    id: "q4",
    kana: "え",
    leadingKana: "え",
    fullPhrase: "え：ええんです 自分のことは ええんです",
    explanation: `私心を出してはいけません。商売第一の徹頭徹尾です。商い
の判断に「私」が出てくるようでは駄賃に飴玉もらって喜ん
でいる小僧の道を出ていません。いつまでも先代の番頭はん
のままなのです。
「私」を出して見せたら相手の思う壺です。こちらの「弱み」
を見せるのですから、それを逆手に搦めとられるのが関の山で
す。商いでは、お客様の「私」を喜ばせるために、自分の「私」
を殺してこそ、商いにかける想いが相手に伝わるので
す。逆に、手ごわい商売人ほど、「私」をくすぐるのが上手
です。入口でピシャッとやらないと、手玉に取られてしまい
ます。`
  },
  {
    id: "q5",
    kana: "お",
    leadingKana: "お",
    fullPhrase: "お：おおきにと 言われてなんぼ 言うてなんぼ",
    explanation: `どんなにお世話になっても「商い」での恩義は「おおきに」
の一言です。本来は、御礼の杯も手土産も要りません。なぜ
ならば、「商売」ですから。
一方的にお世話になるのは、「もらい商い」というのです。
商売に精を出し、「おおきに」と言われる、冥利に尽きます
ね。そして、今日も商いに精を出せる環境があります。
「おおきに」ですね。
お得意様だけにではなく、周りの皆さんにも感謝している人
は、気持ちよく、良い商いが出来ている人です。`
  },
  {
    id: "q6",
    kana: "か",
    leadingKana: "か",
    fullPhrase: "か：カイゼンは  みんなの宝",
    explanation: `もっと良い商売がしたいと願う人には、気づきがあります。
気づきがあればカイゼンができます。カイゼンは心がけさえ
良ければ、いつでも誰でも出来る事です。
そして、その成果は働く仲間、皆のモノとなります。カイゼ
ンの集大成は、しなやかで強い商売を築きます。そうして出
来上がった商売は、ちょっとやそっとでは壊れません。`
  },
  {
    id: "q7",
    kana: "き",
    leadingKana: "き",
    fullPhrase: "き：気が乗らぬ時は ちょっと待つ",
    explanation: `迷いではなく、なんだか気に入らない時というのがあります。
これは「嫌な予感」というものです。
一旦、立ち止まる。少し視点を変えて、眺め直す。草食動物
がやる安全確認です。ウカウカしていたら自分や仲間がやら
れてしまうかもしれない、ビビる能力を全開にして眺め直す、
です。何もなければ、そのまま進めれば良いのです。気にな
るところがあれば、焦らず確認です。`
  },
  {
    id: "q8",
    kana: "く",
    leadingKana: "く",
    fullPhrase: "く：苦労して 掴んだものは  なんじゃらな",
    explanation: `散々苦労して手にしたモノが大して意味のないモノである
ことは、よくあることです。お金や地位の他に信任などの場合
もあります。
本当に必要なモノかどうか。これを先に理解していないと目
の前のモノに振り回されてしまいます。それが真の目的と重
なっていなかったら残念な方向にひた走っていくこともある
のです。対処法は、「常に真の目的を考える」ことです。`
  },
  {
    id: "q9",
    kana: "け",
    leadingKana: "け",
    fullPhrase: "け：計画より  仕上げが大事",
    explanation: `計画も大事です。でも、計画が良くても、実行が伴わない時
があります。「つもり」や「はず」で仕事は成せません。実
行して、仕事を仕上げてこそ商いです。
特に、「我々の仕事はここまでです」などと言ってしまうと、
自分でクビをしめてしまいがちです。仕事は過程ではなく、
結果が出て初めて成し遂げたと言えるのです。
成果を出さなければ意味がない。という厳しい環境では、常に
実行力が問われているのです。頑張ったから丸をもらえるのは
学校です。`
  },
  {
    id: "q10",
    kana: "こ",
    leadingKana: "こ",
    fullPhrase: "こ：ゴミが落ちていたら拾うんです",
    explanation: `自分のお店にゴミが落ちていたら拾うんです。丁稚も、女子
衆も、番頭はんも、旦那さんもです。これが拾えなくなった
ら、福の神が出て行って、貧乏神が軒先をうろつくのです。
理屈ではありません。お店や会社が綺麗であったら良いとい
う事でもありません。
特に意識しなくてもゴミを拾えないようでは商人の資格が
ないのです。`
  },
  {
    id: "q11",
    kana: "さ",
    leadingKana: "さ",
    fullPhrase: "さ：さぁ行こか ココまで落ちたら 上がるだけ",
    explanation: `下がったら上がります。上がったら下がるのです。落ちてい
る時は辛いものです。何をやってもうまくいかないのですが、
心配は無用です。心を強く持ちましょう。必ず上がります。
難しいのは、寒い冬に、「暑い夏は、キンキンのかき氷って
美味しいよね」を思い出す力です。出来そうですか？出来る
のなら大丈夫。季節は巡るし、陽はまた昇ります`
  },
  {
    id: "q12",
    kana: "し",
    leadingKana: "し",
    fullPhrase: "し：商売人 仕事憎んで 人憎まず",
    explanation: `まともな世界には、根が悪い人というのは、そうそう居ませ
ん。仕事の仲間に理解できない人が居ると心苦しいものです
が、その人の人間性には大きな問題はないのです。
人には多面性があり、悪い所もあれば良い所もあります。良
い所を見ると人は憎まなくて済みます。その上で、商売上の
正義に差を感じる時は、仕事のやり方を憎んでいいのです。
これだけで、心の平安を保つことが出来ます。`
  },
  {
    id: "q13",
    kana: "す",
    leadingKana: "す",
    fullPhrase: "す：すいません  言うな",
    explanation: `何が「済まない」のでしょう。深く考えずにへりくだって、
己を小さくしてやり過ごす癖がついてはいけません。謙虚な
のは悪くはないのですが、「すいません」というのは面倒を
避ける為だけに発しているように聞こえます。
謝るというのは難しい仕事です。良く考えなければ謝りの言
葉をつなぐことは出来ません。お店で店員さんに声をかける
時なども一緒です。「すいません」ではなく、「お願いします」
と言いましょう。`
  },
  {
    id: "q14",
    kana: "せ",
    leadingKana: "せ",
    fullPhrase: "せ：精一杯 世に尽くすのが わが生涯",
    explanation: `小さく産まれ、決して強くはない母に育てられたのです。人
は皆、社会というモノがなければ、産まれることも、育つこ
ともできないのです。よくもまぁ、立派になりました。
さぁ、精一杯、社会の為に尽くしましょう。ヒトは社会性の
動物です。世に尽くすのは道徳ではなく、本能です。私に出
来そうなのは商売です。大いに商いをして世のため人のため
に生きましょう。本能の赴くままに。`
  },
  {
    id: "q15",
    kana: "そ",
    leadingKana: "そ",
    fullPhrase: "そ：外は外 内は内やぞ 混ぜるなよ",
    explanation: `外と内は違います。商売は外と内の理屈が違って当然なので
す。また、勤め先と家庭も違うものです。この事を知ってお
きましょう。ここでの理屈が向こうでは通じない、外の問題
を内では感じることが出来ない。そういうモノです。
これを混ぜてしまうと解決の出口を失ってしまいます。最初
っから諦めましょう。通じるところが見つかったら、少し嬉
しくなります。`
  },
  {
    id: "q16",
    kana: "た",
    leadingKana: "た",
    fullPhrase: "た：鷹の目と 地虫の目と 人の目",
    explanation: `遠く高いところからの視線、地を這う目線、人間として見つ
める心の目。3 つの見方が必要です。鷹の目は、小さな事を
忘れさせ全体像を掴むのに優れています。地虫の目は、小さ
な凸凹をほじくり出します。この高低差は、きっかけや、攻
め手、綻びの兆しを見せてくれます。
最後の人の目は、真の目的を照らし、推進力や抑止力を発揮
してくれます。迷っても迷わなくても3 つの視線で見る癖
をつけましょう。`
  },
  {
    id: "q17",
    kana: "ち",
    leadingKana: "ち",
    fullPhrase: "ち：チャンスが来るのは 覚悟した後やで",
    explanation: `チャンスを掴みましょう、というのは簡単ですが、実はそう簡
単なことではありません。チャンスは、覚悟を持って働き始
めた人にしか訪れません。それも、覚悟した後しばらく経っ
てからなのです。
腹の括りがまだ甘い内や、覚悟した直後に訪れる好機は、随
分と油断の元なのです。商人は、何をしていても商売のチャ
ンスを見つけるものです。`
  },
  {
    id: "q18",
    kana: "つ",
    leadingKana: "つ",
    fullPhrase: "つ：積み上げていく人生って 憧れへんか",
    explanation: `人生には、アップダウンがありますが、できることなら、山
折りが続く人生のほうが良いですね。世の中には、蛙飛びの
ような人生を過ごしている人もいます。
常にリセットを繰り返すような人生です。
丁寧に積み重ねていくということは、その時々の節目で冷静
な判断を行うということです。
誘惑に負け、自分の欲に負けて、早まった行動をしないこと
です。商いを行いながらこれを貫くには相当な腕が要りま
す。`
  },
  {
    id: "q19",
    kana: "て",
    leadingKana: "て",
    fullPhrase: "て：適当ちゃうで 適度やで",
    explanation: `「まぁ、適当でええわ」というのは心得違いです。仕事に手を
抜くことと、物事を適度に扱うことを取り違えてはいけませ
ん。
自らの資源を傷めつけすぎず、且つ何事に対しても最適な具
合を考えることが大切です。商いの道では、自分の体力と心
の状態、周囲の人達の状態、お客様の状態を常に把握して事
に当たることが必要です。`
  },
  {
    id: "q20",
    kana: "と",
    leadingKana: "と",
    fullPhrase: "と：とり返しのつかんことを したらあかんで",
    explanation: `誰にでも、「しまった」という事はあります。ですが、そん
な事の多くは、挽回可能です。落ち込む必要は、ありません。
かと言って何でもして良い訳ではない。商いの世界は、お客
様あっての商売であり、特に信頼を損なうような事をすれば
取り返しがつかなくなります。
損得勘定で、どうしても「甘い誘惑」に心を動かされる事
があります。そんな時にこそ、輪徳の精神を心に描き、誠
実に判断できるように心掛けたいものです。`
  },
  {
    id: "q21",
    kana: "な",
    leadingKana: "な",
    fullPhrase: "な：なんぼのもんじゃい 何のためやねん",
    explanation: `目の前のやるべきことが見えている人は、その事だけを考え
ています。「なんぼになるんやろう」と、ついつい損得勘定
を気にしすぎてしまう癖がついてしまうと大事なことを見失
います。
常に「何のためが先やで」を念頭に働いていれば、どれだけ
働いても心身は傷みません。むしろ鍛えられます。
暫くの間、なんぼのもんじゃいを忘れてみませんか？`
  },
  {
    id: "q22",
    kana: "に",
    leadingKana: "に",
    fullPhrase: "に：人には きつう言え",
    explanation: `愛情を持っている人だからこそ、きつく言えるということ
があります。むやみやたらと厳しいことを言う必要はあり
ませんが、時には毅然とした態度で接する必要があります。
お客様に甘えたり、なぁなぁの関係になったりすると、本
当に言わなくてはいけないことが言えなくなります。「ここ
から先は、こうさせてもらう」という線引きが必要なので
す。

きつく言えるのは、それまでに築いた信頼関係があるから
こそです。そして、きつく言った後ほど、時に甲斐甲斐し
く、相手の幸せを願っている姿を示す必要があるのです。`
  },
  {
    id: "q23",
    kana: "ぬ",
    leadingKana: "ぬ",
    fullPhrase: "ぬ：ぬくもりの 有る言葉を 掛けんかい",
    explanation: `やるべき仕事に精を出して踏ん張ることが大切ですが、ポッ
カリと気持ちが欠けることもあります。ふと涙が流れそうな
気持ちにもなるでしょう。そんな時に掛けてもらえる温かい
一言があればしあわせです。
温かい一言を掛けてもらうためには、自分自身が温かい言葉
をかけるようにならなければなりません。`
  },
  {
    id: "q24",
    kana: "ね",
    leadingKana: "ね",
    fullPhrase: "ね：根っこみる 葉っぱみんでも 根っこみる",
    explanation: `その事、その人、その物の根本を理解が出来なければ、対
処対応は出来ません。全体像を掴むのも大事ですが、その
先にある本質を掴むことに専心しましょう。
特に大事な主題に対しては、心静かに本質に迫りましょ
う。商いの道の根っこを知るというのは、極めるというこ
とです。`
  },
  {
    id: "q25",
    kana: "の",
    leadingKana: "の",
    fullPhrase: "の：ノコの歯は   引いて切って 押して切る",
    explanation: `要諦は「ノコギリ商い」です。空荷で動いてはいけません。
配達先で仕入れることで、行って商い、帰って商いがノコギ
リ商いです。これは、商品の移動だけではありません。1 つ
の行動を 2 つ以上目的に使うのです。
集中力は欠くことになりますが、これは慣れです。うまく出
来るようになると生産性は倍です。`
  },
  {
    id: "q26",
    kana: "は",
    leadingKana: "は",
    fullPhrase: "は：早起きは  眠たいけども  憂いなし",
    explanation: `朝の時間はダイヤモンドです。夜はお酒を飲んでいたり、疲
れた体と頭であったり。
朝は自己管理がしやすいですし、大概は夜よりも調子が良い
のです。商売は、朝方に稼いでおいて、午後は火消しに回る
位が丁度良いのです。`
  },
  {
    id: "q27",
    kana: "ひ",
    leadingKana: "ひ",
    fullPhrase: "ひ：膝ついて 詫びる覚悟は できてんか",
    explanation: `権利と義務とか、相手と自分の責任範囲などを細かく確認せ
ずに始まった商売が、大半です。
商いの道では、お客様に向かって、どっちが悪いということ
を言っても仕方がないのです。
真摯に詫びるべき時は、正直に詫びる一択です。
「どこまでしてくれるのですか？」という問いに対して、
「いえ、どこまでもです」と答えられて初めて、
商いとして成長するのです。`
  },
  {
    id: "q28",
    kana: "ふ",
    leadingKana: "ふ",
    fullPhrase: "ふ：踏み倒したら あかん",
    explanation: `支払いを踏み倒す。約束を反故にする。これらは一時的に
は自分を楽にするかも知れませんが、長い目で見れば商い
の道を自ら閉ざす行為です。
信用は、お金では買えません。小さな約束を守ることの積み
重ねが、大きな信用に繋がります。
どうしても約束が守れない事態になったのであれば、まず
は自分から頭を下げに行く。事情を説明し、誠意を尽くす。
それでも信頼関係が続くかどうか。そこに、その人の商人
としての本当の値打ちが現れます。`
  },
  {
    id: "q29",
    kana: "へ",
    leadingKana: "へ",
    fullPhrase: "へ：変わらんと あかんことも あるやろな",
    explanation: `時代や環境が変われば、今まで通りのやり方が通用しなくな
ることもあります。「昔はこれで上手くいっていたんや」と
言い訳している間に、状況はどんどん変わっていきます。
変えたくないもの（理念や信念など）と、変えていくべきも
の（やり方、仕組みなど）を見極めることが大切です。`
  },
  {
    id: "q30",
    kana: "ほ",
    leadingKana: "ほ",
    fullPhrase: "ほ：ほんまの はたらきって なんやろな",
    explanation: `「働く」という字は、「人が動く」と書きますが、商いの働
きは「人のために動く」ことです。
自分のためだけに動いていると、どこかで息切れします。
人の役に立っている実感、自分の働きが誰かの笑顔や安心に
つながっている実感があると、しんどくても踏ん張れます。
はたらきの本質を、時々立ち止まって考えてみたいものです。`
  },
  {
    id: "q31",
    kana: "ま",
    leadingKana: "ま",
    fullPhrase: "ま：任されて なんぼやで",
    explanation: `商いの世界では、「任される」ということは信頼されている
証です。
任される前に、あれこれと自分の正しさだけを主張していな
いでしょうか。まずは、目の前の仕事をコツコツとやり切る。
その積み重ねが、「あいつに任せたら大丈夫や」という評価に
つながっていきます。
任されることを喜びに変えられるようになれば、一人前です。`
  },
  {
    id: "q32",
    kana: "み",
    leadingKana: "み",
    fullPhrase: "み：身の丈に 合った商い せえ",
    explanation: `背伸びし過ぎた商いは、どこかで無理が出ます。
見栄や欲に流されて、自分たちの力以上のことをしようとす
ると、従業員にも取引先にも負担をかけることになります。
身の丈に合った商いとは、「小さくまとまる」ことではなく、
今の自分たちの力を冷静に見つめ、その範囲で最大限の工夫
をすることです。
その積み重ねが、やがて身の丈そのものを大きくしてくれま
す。`
  },
  {
    id: "q33",
    kana: "む",
    leadingKana: "む",
    fullPhrase: "む：無理はするな  されど 手は抜くな",
    explanation: `無理をすれば、一時的には成果が出るかも知れませんが、長
続きはしません。体も心も壊れてしまっては元も子もないの
です。
一方で、手を抜いていては、お客様に対しても仲間に対して
も失礼です。丁寧にやるべき仕事は丁寧にやる。そのうえで、
無理をし過ぎないバランスを見つけることが大切です。
「今日はここまで」「ここからは明日」。そんな切り替え
も、長く商いを続けるための知恵です。`
  },
  {
    id: "q34",
    kana: "め",
    leadingKana: "め",
    fullPhrase: "め：目先ばっかり 見るなや",
    explanation: `今日・明日の売上も大事です。でも、目先の数字ばかりを
追いかけていると、お客様との関係も、会社の将来も痩せ
細っていきます。
少し先の未来を想像してみる。一年先、三年先、十年先に、
どんな商いをしていたいのか。そのために今、何をしておく
べきなのか。
目先のことだけでなく、先のことを考えて動けるかどうかが、
商人の器を決めていきます。`
  },
  {
    id: "q35",
    kana: "も",
    leadingKana: "も",
    fullPhrase: "も：儲けても ええ  でも 欲張るな",
    explanation: `商いは、儲けてなんぼです。利益を出せなければ、従業員も
家族も守れませんし、次の投資もできません。
大事なのは、「どこまでを良しとするか」です。儲けること
自体が悪いのではなく、欲に目がくらんで、約束や信義を
後回しにしてしまうことが問題なのです。
正当に儲ける。感謝されながら儲ける。そのためには、欲張
り過ぎない自制心が必要です。`
  },
  {
    id: "q36",
    kana: "や",
    leadingKana: "や",
    fullPhrase: "や：やれることから 始めんかい",
    explanation: `大きな構想を描くことは大切ですが、「そのうち」「いつか」
と言っているだけでは何も変わりません。
今できることは何か。小さな一歩でもいいから、今日から
始める。それを積み重ねていくうちに、大きな変化になって
いきます。
完璧を求め過ぎて動けなくなるより、七割くらいの準備で
動き出す。やりながら修正していく。そんな一歩が、商いを
前に進めていきます。`
  },
  {
    id: "q37",
    kana: "ゆ",
    leadingKana: "ゆ",
    fullPhrase: "ゆ：ゆっくりやけど 一歩ずつ",
    explanation: `周りと比べ過ぎると、「自分たちは遅れている」と焦ってしま
います。でも、商いの道は競走ではありません。
大事なのは、自分たちなりのペースで、一歩ずつ進んでいく
ことです。昨日より少しでも良くなっているか。去年より
一歩でも前に出ているか。その積み重ねが、やがて大きな差
になります。
急ぎ過ぎて足元をすくわれるより、確実に一歩一歩を踏みし
めていく方が、長い目で見て強い商いになります。`
  },
  {
    id: "q38",
    kana: "よ",
    leadingKana: "よ",
    fullPhrase: "よ：よく聞いて よく観て 判断せえ",
    explanation: `情報が溢れている時代だからこそ、何を信じて判断するかが
大事になっています。
人の話をよく聞く。現場をよく観る。数字もきちんと見る。
そのうえで、自分の頭で考えて決める。それが商人の役割
です。
誰かの意見に流されるだけではなく、自分なりの物差しを
持つこと。その物差しを磨き続けること。それが、判断力を
高めてくれます。`
  },
  {
    id: "q39",
    kana: "ら",
    leadingKana: "ら",
    fullPhrase: "ら：来世でも 同じ生き様 やりまっせ",
    explanation: `今生だけでなく、来世でも同じ様に生きていこうという不変
の構えで人生に臨みましょう。または、今はまだ答を持ちあ
わせていないが、その内に必ず納得のいく生き方を見つけ、
邁進することを望む、ということです。
「人生は、一度きり」という考えは相容れません。やりたい
事をやるのではなく、やるべき事をやるのです。`
  },
  {
    id: "q40",
    kana: "り",
    leadingKana: "り",
    fullPhrase: "り：理解には  聞読話書と  四段階",
    explanation: `わかった！という感覚には 4 つの段階があります。最初が
聞いてわかる、次が読んでわかる、その事について話すこと
が出来る、最後に書くことが出来る、です。
聞く理解の段階では、理解に齟齬が出ることも多いのです。
大事な事柄を共有するためには、相手の理解の段階が何処に
在るかを考えてみて下さい。`
  },
  {
    id: "q41",
    kana: "る",
    leadingKana: "る",
    fullPhrase: "る：ルールはなぁ 心が勝手に 守るモノ",
    explanation: `ルールとは、集団の利益を守るため、衝突や摩擦を減らすた
めの知恵です。商売は利益が相反する事項が多々あります。
お互いに気持ちよく商売を続けていくためには、一定のルー
ルが必要です。
本当に良いルールは、誰かに監視されているから守るのでは
なく、自分の心が勝手に守ろうとするものです。`
  },
  {
    id: "q42",
    kana: "れ",
    leadingKana: "れ",
    fullPhrase: "れ：連れを大事に せえ",
    explanation: `一緒に働く仲間、一緒に商いをしている相手。そういう「連
れ」をどれだけ大事にできているかが、その人の器を映し
出します。
自分の都合だけで相手を振り回していないか。いつも感謝
の気持ちを持って接しているか。苦しい時には助け合えて
いるか。
連れを大事にできる人の周りには、自然と人が集まってきま
す。それが、商いにとって何よりの財産です。`
  },
  {
    id: "q43",
    kana: "ろ",
    leadingKana: "ろ",
    fullPhrase: "ろ：論じてみぃ　証拠がなくても　論じてみぃ",
    explanation: `論より証拠です。それでも、どうしても納得が出来ない事柄
もあります。証拠の積み上げに対して勝てる要素がないので
しょうが、直感は信じてみても良いでしょう。
取っ掛かり、引っ掛かりを探して形振りかまわず懸命に論じ
てみましょう。証拠の薄い所を突き破ることもあれば、完膚
なきまで叩きのめされることもあり、間違いに気づくことも
あります。何れにせよ、現状打破には行動です。`
  },
  {
    id: "q44",
    kana: "わ",
    leadingKana: "わ",
    fullPhrase: "わ：わからん時　わからんと言う素直さよ",
    explanation: `頭の回転が追いつかない時もありますが、何より知識が不足
している「わからん」は闇の中にいるようで居心地が悪いも
のです。わかった振りして、後で調べるというのも方法です
が、いつもそれではいけません。
特に大事な商談や打合せの時など、相手のいる時、その相手
は、こちらの反応を期待しているのです。真剣に向き合う時
は「わかりません、教えて下さい」と言いましょう。`
  },
  {
    id: "q45",
    kana: "を",
    leadingKana: "を",
    fullPhrase: "を：をそ鳥は　眠り豚より　ちょっとええ",
    explanation: `「をそ」とは軽率という意味で、「をそ鳥」とは、「おおおそどり」という慌て者の鳥のことです。遅刻より、早く着き過ぎる方がよいです。商い事は、大抵は、遅いより、早い方が良いのです。慌て者
は決して良くはないですが、のろまよりはマシです。冷静か
つ迅速は理想ですが、出来ない時は、をそ鳥で良いのです。`
  },
  {
    id: "q46",
    kana: "ん",
    leadingKana: "ん",
    fullPhrase: "ん：ん？ってな  疑問に思うが  金の時",
    explanation: `違和感が大きい時に、人は「ん？」と思います。きっと何か
がおかしいのです。ひょっとすると己の感覚や知識、考え方
がおかしいのかも知れませんが、相手がおかしいこともあり
ます。また、前提がおかしい時もあります。
「ん？」を無視しないことです。「ん？」は気づきの種です。
違和感の正体を突き止めることで、大きな発見や成⾧がある
ものです。`
  },
];


    // ====== 状態管理 ======
    let currentIndex = 0;         // 出題順インデックス
    let questionOrder = [];       // 出題順（questions のインデックスシャッフル）
    let score = 0;
    let canAnswer = false;
    let hasAnswered = false;
    let timerId = null;
    let questionStartTime = null;

    // ====== DOM ======
    const leadingKanaEl   = document.getElementById("leadingKana");
    const fullPhraseEl    = document.getElementById("fullPhrase");
    const cardsGridEl     = document.getElementById("cardsGrid");
    const timerTextEl     = document.getElementById("timerText");
    const scoreTextEl     = document.getElementById("scoreText");
    const messageEl       = document.getElementById("message");
    const explanationEl   = document.getElementById("explanation");
    const nextButtonEl    = document.getElementById("nextButton");
    const questionCountEl = document.getElementById("questionCount");
    const progressEl      = document.getElementById("progress");
    const finalResultEl   = document.getElementById("finalResult");

    // ====== ユーティリティ ======
    function shuffleArray(arr) {
      const a = arr.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function resetTimer() {
      if (timerId !== null) {
        clearInterval(timerId);
        timerId = null;
      }
      timerTextEl.textContent = "--.-";
    }

    function updateTimer() {
      if (!questionStartTime) return;
      const elapsed   = Date.now() - questionStartTime;
      const remaining = Math.max(0, MAX_TIME_MS - elapsed);
      const sec       = remaining / 1000;
      timerTextEl.textContent = sec.toFixed(1);

      if (remaining <= 0 && !hasAnswered) {
        handleTimeout();
      }
    }

    function startTimer() {
      resetTimer();
      questionStartTime = Date.now();
      timerId = setInterval(updateTimer, 100);
    }

    function stopTimer() {
      if (timerId !== null) {
        clearInterval(timerId);
        timerId = null;
      }
    }

    function setMessage(text, type) {
      messageEl.textContent = text;
      messageEl.classList.remove("ok", "ng");
      if (type === "ok") messageEl.classList.add("ok");
      if (type === "ng") messageEl.classList.add("ng");
    }

    function getCurrentQuestion() {
      const qIndex = questionOrder[currentIndex];
      return questions[qIndex];
    }

    // ====== カード（正解＋不正解3枚）を作る ======
    function buildCardsForQuestion(q) {
      const kana = q.kana;

      const correctKey = kanaToFileKey[kana];
      const correctCard = {
        src: `images/${correctKey}.jpg`,
        alt: `${kana} の札`,
        isCorrect: true
      };

      const wrongKanaPool = kanaList.filter(k => k !== kana);
      const wrongKanaSelected = shuffleArray(wrongKanaPool).slice(0, 3);

      const wrongCards = wrongKanaSelected.map(k => {
        const key = kanaToFileKey[k];
        return {
          src: `images/${key}.jpg`,
          alt: `${k} の札`,
          isCorrect: false
        };
      });

      return shuffleArray([correctCard, ...wrongCards]);
    }

    // ====== 問題表示 ======
    function showQuestion() {
      const q = getCurrentQuestion();
      if (!q) return;

      canAnswer = false;
      hasAnswered = false;
      resetTimer();
      setMessage("", null);
      explanationEl.style.display = "none";
      explanationEl.textContent = "";
      nextButtonEl.style.display = "none";
      finalResultEl.textContent = "";

      const questionNumber = currentIndex + 1;
      questionCountEl.textContent = `第${questionNumber}問`;
      progressEl.textContent = `${questionNumber} / ${questions.length}`;

      leadingKanaEl.textContent = q.leadingKana;
      fullPhraseEl.textContent = "";
      cardsGridEl.innerHTML = "";

      setTimeout(() => {
        const cards = buildCardsForQuestion(q);
        renderCards(cards);
        canAnswer = true;
        startTimer();
      }, 1000);

      setTimeout(() => {
        fullPhraseEl.textContent = q.fullPhrase;
      }, 2000);
    }

    function renderCards(cards) {
      cardsGridEl.innerHTML = "";

      cards.forEach(card => {
        const cardEl = document.createElement("div");
        cardEl.className = "card";
        cardEl.dataset.correct = card.isCorrect ? "1" : "0";

        const coverEl = document.createElement("div");
        coverEl.className = "kana-cover";

        const imgEl = document.createElement("img");
        imgEl.src = card.src;
        imgEl.alt = card.alt;

        cardEl.appendChild(imgEl);
        cardEl.appendChild(coverEl);

        cardEl.addEventListener("click", () => {
          handleAnswer(cardEl, card.isCorrect);
        });

        cardsGridEl.appendChild(cardEl);
      });
    }

    // ====== 回答処理 ======
    function handleAnswer(cardEl, isCorrect) {
      if (!canAnswer || hasAnswered) return;

      hasAnswered = true;
      canAnswer = false;
      stopTimer();

      const elapsed   = Date.now() - questionStartTime;
      const remaining = Math.max(0, MAX_TIME_MS - elapsed);
      let deltaScore  = 0;

      const allCards = cardsGridEl.querySelectorAll(".card");
      allCards.forEach(c => c.classList.add("disabled"));

      allCards.forEach(c => {
        if (c.dataset.correct === "1") {
          c.classList.add("correct");
        }
      });

      if (isCorrect) {
        const sec = remaining / 1000;
        deltaScore = Math.round(sec) * POINTS_PER_SECOND;
        score += deltaScore;

        cardEl.classList.add("correct");
        setMessage(`正解！ +${deltaScore} 点`, "ok");
      } else {
        deltaScore = WRONG_PENALTY;
        score += deltaScore;
        cardEl.classList.add("wrong");
        setMessage(`残念… ${WRONG_PENALTY} 点`, "ng");
      }

      scoreTextEl.textContent = score.toString();

      const q = getCurrentQuestion();
      explanationEl.textContent = q.explanation;
      explanationEl.style.display = "block";

      if (currentIndex < questionOrder.length - 1) {
        nextButtonEl.textContent = "次の問題へ";
      } else {
        nextButtonEl.textContent = "結果を見る";
      }
      nextButtonEl.style.display = "inline-block";
    }

    function handleTimeout() {
      if (hasAnswered) return;
      hasAnswered = true;
      canAnswer = false;
      stopTimer();

      const allCards = cardsGridEl.querySelectorAll(".card");
      allCards.forEach(c => c.classList.add("disabled"));

      allCards.forEach(c => {
        if (c.dataset.correct === "1") {
          c.classList.add("correct");
        }
      });

      score += WRONG_PENALTY;
      scoreTextEl.textContent = score.toString();
      setMessage(`時間切れ！ ${WRONG_PENALTY} 点`, "ng");

      const q = getCurrentQuestion();
      explanationEl.textContent = q.explanation;
      explanationEl.style.display = "block";

      if (currentIndex < questionOrder.length - 1) {
        nextButtonEl.textContent = "次の問題へ";
      } else {
        nextButtonEl.textContent = "結果を見る";
      }
      nextButtonEl.style.display = "inline-block";
    }

    function goToNext() {
      if (currentIndex < questionOrder.length - 1) {
        currentIndex += 1;
        showQuestion();
      } else {
        finalResultEl.textContent =
          `全${questions.length}問終了！ あなたのあきんどスコアは ${score} 点です。`;
        nextButtonEl.style.display = "none";
      }
    }

    nextButtonEl.addEventListener("click", goToNext);

    // ====== ゲーム開始 ======
    function startGame() {
      score = 0;
      scoreTextEl.textContent = "0";

      const indices = [];
      for (let i = 0; i < questions.length; i++) {
        indices.push(i);
      }
      questionOrder = shuffleArray(indices);
      currentIndex = 0;

      showQuestion();
    }

    startGame();
  </script>
</body>
</html>
