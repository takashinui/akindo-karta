<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>あきんどカルタ</title>

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
      background: #f5f5f5;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 12px;
      box-sizing: border-box;
    }

    /* 現在の問題の文字（かな1文字） */
    #currentKana {
      text-align: center;
      font-size: 30px;
      font-weight: bold;
      margin: 4px 0;
    }

    /* fullPhrase の表示領域 */
    #fullPhrase {
      min-height: 2.5em;
      font-size: 14px;
      font-weight: 600;
      text-align: center;
      padding: 4px;
      margin-bottom: -20px;
    }

    /* カード（絵札）のグリッド：iPhone 縦基準で 2×2 */
    .cards {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0px;
      margin-top: 0px;
    }

    .card {
      position: relative;
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
      cursor: pointer;
    }

    .card img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
    }

    /* 絵札右肩の黒丸を完全に黒塗りして、元の白抜きひらがなを潰す */
    .kana-mask {
      position: absolute;
      top: 15px;
      right: 15px;
      width: 40px;
      height: 40px;
      background: black;
      border-radius: 50%;
      opacity: 1;
      pointer-events: none;
    }

    /* 〇／✕表示用のオーバーレイ */
    .result-mark {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 96px;
      font-weight: bold;
      color: rgba(255, 255, 255, 0.9);
      text-shadow: 0 0 4px rgba(0, 0, 0, 0.8);
      pointer-events: none;
    }

    /* 解説表示欄：高さを制限し、中だけスクロール */
    #explanation {
      display: none;
      background: #fff;
      padding: 10px;
      margin-top: 12px;
      border-radius: 10px;
      max-height: 200px;
      overflow-y: auto;
      font-size: 14px;
      line-height: 1.5;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    /* 次の問題ボタン */
    #nextButton {
      margin-top: 8px;
      padding: 8px 16px;
      font-size: 14px;
      border-radius: 6px;
      border: none;
      background: #1976d2;
      color: #fff;
      cursor: pointer;
      width: 100%;
      display: none; /* 最初は非表示 */
    }

    #nextButton:disabled {
      opacity: 0.5;
      cursor: default;
    }

    /* iPad mini など横幅が広いとき少し余裕を持たせる */
    @media (min-width: 768px) {
      #currentKana {
        font-size: 48px;
      }
      #fullPhrase {
        font-size: 20px;
      }
      .cards {
        gap: 12px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div id="currentKana"></div>

    <!-- 先に絵札 -->
    <div class="cards" id="cards"></div>

    <!-- 絵札の下に fullPhrase -->
    <div id="fullPhrase"></div>

    <!-- fullPhrase の下に解説 -->
    <div id="explanation"></div>

    <!-- 解説のさらに下に「次の問題」ボタン -->
    <button id="nextButton">次の問題</button>
  </div>

  <script>
    // ==============================
    //  質問データ
    // ==============================

    // かな → ファイル名
    function kanaToFile(k) {
      const map = {
        "あ":"a.jpg","い":"i.jpg","う":"u.jpg","え":"e.jpg","お":"o.jpg",
        "か":"ka.jpg","き":"ki.jpg","く":"ku.jpg","け":"ke.jpg","こ":"ko.jpg",
        "さ":"sa.jpg","し":"si.jpg","す":"su.jpg","せ":"se.jpg","そ":"so.jpg",
        "た":"ta.jpg","ち":"ti.jpg","つ":"tu.jpg","て":"te.jpg","と":"to.jpg",
        "な":"na.jpg","に":"ni.jpg","ぬ":"nu.jpg","ね":"ne.jpg","の":"no.jpg",
        "は":"ha.jpg","ひ":"hi.jpg","ふ":"hu.jpg","へ":"he.jpg","ほ":"ho.jpg",
        "ま":"ma.jpg","み":"mi.jpg","む":"mu.jpg","め":"me.jpg","も":"mo.jpg",
        "や":"ya.jpg","ゆ":"yu.jpg","よ":"yo.jpg",
        "ら":"ra.jpg","り":"ri.jpg","る":"ru.jpg","れ":"re.jpg","ろ":"ro.jpg",
        "わ":"wa.jpg","を":"wo.jpg","ん":"n.jpg"
      };
      return map[k];
    }

    let currentIndex = 0;
    let order = [];
    let hasAnswered = false;

    function shuffleOrder() {
      order = [...Array(questions.length).keys()];
      order.sort(() => Math.random() - 0.5);
    }

    function nextQuestionIndex() {
      currentIndex++;
      if (currentIndex >= questions.length) {
        currentIndex = 0;
        shuffleOrder();
      }
    }

    function showQuestion() {
      hasAnswered = false;

      const q = questions[order[currentIndex]];

      const kanaEl = document.getElementById("currentKana");
      const fullPhraseEl = document.getElementById("fullPhrase");
      const explanationEl = document.getElementById("explanation");
      const nextBtn = document.getElementById("nextButton");

      // 文字（かな1文字）を表示
      kanaEl.textContent = q.leadingKana;

      // fullPhrase / 解説 / ボタンをリセット
      fullPhraseEl.textContent = "";
      explanationEl.style.display = "none";
      explanationEl.textContent = "";
      nextBtn.style.display = "none";
      nextBtn.disabled = true;

      // 絵札4枚を作る
      createCards(q);
    }

    function createCards(q) {
      const cardsEl = document.getElementById("cards");
      cardsEl.innerHTML = "";

      const correctKana = q.kana;

      // 正解以外のかなを集めてランダムに3つ選択
      const allKana = questions.map(x => x.kana);
      const wrongCandidates = allKana.filter(k => k !== correctKana);
      const wrong3 = wrongCandidates
        .sort(() => Math.random() - 0.5)
        .slice(0, 3);

      // 正解＋誤答3を混ぜて4枚
      const choiceKanaList = [correctKana, ...wrong3]
        .sort(() => Math.random() - 0.5);

      choiceKanaList.forEach(k => {
        const cardDiv = document.createElement("div");
        cardDiv.className = "card";

        const img = document.createElement("img");
        img.src = "images/" + kanaToFile(k);
        img.alt = k;

        const mask = document.createElement("div");
        mask.className = "kana-mask";

        const mark = document.createElement("div");
        mark.className = "result-mark";
        mark.textContent = "";

        cardDiv.appendChild(img);
        cardDiv.appendChild(mask);
        cardDiv.appendChild(mark);

        cardDiv.onclick = () => {
          const fullPhraseEl = document.getElementById("fullPhrase");
          const explanationEl = document.getElementById("explanation");
          const nextBtn = document.getElementById("nextButton");

          // すでに正解を選んだ後は何もしない
          if (hasAnswered && k !== correctKana) return;

          if (k === correctKana) {
              // ★ 正解したら4枚すべての黒丸マスクを消す
document.querySelectorAll(".kana-mask").forEach(m => m.style.display = "none");
            
            // 正解
            hasAnswered = true;
            mark.textContent = "〇";
            mark.style.color = "rgba(0, 150, 0, 0.9)";

            // fullPhrase をここで表示
            fullPhraseEl.textContent = q.fullPhrase;

            // 解説を表示
            showExplanation(q);

            // 「次の問題」ボタンを表示
            nextBtn.style.display = "block";
            nextBtn.disabled = false;
          } else {
            // 不正解：✖表示（問題はそのまま続行）
            mark.textContent = "✖";
            mark.style.color = "rgba(200, 0, 0, 0.9)";
          }
        };

        cardsEl.appendChild(cardDiv);
      });
    }

    function showExplanation(q) {
      const explanationEl = document.getElementById("explanation");
      explanationEl.textContent = q.explanation;
      explanationEl.style.display = "block";
    }

    function startGame() {
      shuffleOrder();
      currentIndex = 0;
      console.log("questions:", questions.length, "問");

      const nextBtn = document.getElementById("nextButton");
      nextBtn.addEventListener("click", () => {
        nextQuestionIndex();
        showQuestion();
        window.scrollTo({ top: 0, behavior: "smooth" });
      });

      showQuestion();
    }

    window.addEventListener("load", startGame);
  </script>
</body>
</html>
